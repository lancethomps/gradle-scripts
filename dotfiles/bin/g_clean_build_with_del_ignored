#!/usr/bin/env bash
################################################################### SETUP ########################################################################
# shellcheck source=.dotfiles/lib/common.sh disable=SC2016,SC1091
if test -e "${DOTFILES}/lib/common.sh"; then source "${DOTFILES}/lib/common.sh"; else echo '"${DOTFILES}/lib/common.sh" does not exist - resolved to: '"${DOTFILES}/lib/common.sh" && exit 1; fi
set -o errexit -o errtrace -o nounset
##################################################################################################################################################

mapfile -t delete_ignored < <(git ignored --directory | pcregrep '(^(\.gradle|build)/$|/(\.gradle|build)/$)')
if test "${#delete_ignored[@]}" -ne 0; then
  echo_with_title_sep "Deleting below ignored git directories"
  join_by_newline_with_end "${delete_ignored[@]}"
  rm -rf "${delete_ignored[@]}"
fi

echo_with_title_sep "Running: g clean build --rerun-tasks $*"
g clean build --rerun-tasks "$@"
